# 権限取得確認・再取得UI実装計画

## 概要
macOSの権限（アクセシビリティ権限、画面録画権限等）が取得できているかを確認し、必要に応じて再取得を促すUIを実装する。

## Phase 1: TaskbarHelperへの権限確認コマンド追加

### 目標
TaskbarHelper（Swift）に権限状態を確認するコマンドを追加し、Electron側から権限状態を取得できるようにする。

### 実装内容
1. **Swift側への追加機能**
   - アクセシビリティ権限確認関数の実装
   - 画面録画権限確認関数の実装
   - 権限状態を返すJSONレスポンス形式の定義
   - 新しいコマンド `check-permissions` の追加

2. **確認する権限**
   - `AXIsProcessTrusted()` - アクセシビリティ権限
   - `CGDisplayStreamCreate` 権限 - 画面録画権限
   - その他必要な権限

3. **レスポンス形式**
   ```json
   {
     "command": "check-permissions",
     "accessibility": true/false,
     "screenRecording": true/false,
     "timestamp": "ISO8601"
   }
   ```

### 変更ファイル
- `nativeSrc/taskbar.helper/` 内のSwiftソースファイル
- コマンド処理ロジックの拡張

## Phase 2: 現在の権限チェック機能の置き換え

### 目標
既存の権限チェック機能を新しいシステムに置き換え、UIから権限の確認・再取得を行えるようにする。

### 実装内容
1. **Main Process側の実装**
   - `src/main/funcs/helper.ts` の拡張
   - 権限チェック関数の実装
   - IPC経由での権限状態取得API

2. **Renderer Process側の実装**
   - 権限状態表示コンポーネント
   - 権限再取得ボタン
   - 権限不足時の警告UI
   - システム環境設定への誘導機能

3. **UI設計**
   - 設定画面（option.html）への権限セクション追加
   - 権限状態のリアルタイム表示
   - 権限取得ガイドの表示
   - 必要に応じてメイン画面での権限警告表示

### 統合ポイント
- 既存の `src/main/funcs/helper.ts` との統合
- `src/main/funcs/events.ts` でのIPC処理追加
- Vue.js コンポーネントでの状態管理

## 技術的考慮事項

### セキュリティ
- 権限チェックの頻度制限
- 権限要求のタイミング最適化

### UX設計
- 権限不足時の分かりやすい説明
- システム環境設定への適切な誘導
- 権限取得後の自動更新

### エラーハンドリング
- TaskbarHelperとの通信エラー処理
- 権限確認失敗時のフォールバック
- ユーザー操作キャンセル時の処理

## 実装順序

1. **Phase 1 - Swift側実装**
   - 権限確認関数の実装
   - コマンド処理の拡張
   - テスト・動作確認

2. **Phase 2 - Electron側実装**
   - Main Processでの権限チェック機能
   - IPCイベントハンドラーの追加
   - Renderer側UI実装
   - 既存機能との統合テスト

## 成功指標
- すべての必要な権限の状態が正確に取得できる
- 権限不足時にユーザーが適切に誘導される
- 権限取得後にアプリが正常に動作する
- 既存機能に影響を与えない