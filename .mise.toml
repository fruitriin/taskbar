[tools]
bun = "latest"
node = "20.10.0"

[env]
NODE_ENV = "development"

[tasks.dev]
description = "開発サーバーを起動"
run = "cp nativeSrc/DerivedData/taskbar.helper/Build/Products/Release/taskbar.helper resources/TaskbarHelper & npx electron-vite dev"

[tasks.build]
description = "アプリケーションをビルド"
run = "cp nativeSrc/DerivedData/taskbar.helper/Build/Products/Release/taskbar.helper resources/TaskbarHelper && npx electron-vite build"

[tasks.swiftbuild]
description = "Swiftヘルパーをビルド"
run = "xcodebuild -project nativeSrc/taskbar.helper.xcodeproj -scheme taskbar.helper -configuration Release build && echo [COPY]binary copy to resouces && cp nativeSrc/DerivedData/taskbar.helper/Build/Products/Release/taskbar.helper resources/TaskbarHelper && echo [COPY] done."

[tasks."build:mac"]
description = "macOSユニバーサルバイナリをビルド"
run = "mise run build && npx electron-builder --mac --universal"

[tasks."install-app"]
description = "アプリをApplicationsフォルダにインストール"
run = "rm -rf /Applications/taskbar.fm.app && cp -a dist/mac-universal/taskbar.fm.app /Applications/taskbar.fm.app"

[tasks.helper]
description = "Xcodeヘルパープロジェクトを開く"
run = "open nativeSrc/taskbar.helper.xcodeproj/project.xcworkspace"

[tasks.format]
description = "Prettierでコードをフォーマット"
run = "bun prettier --write '**/*.{js,ts,vue,html,css}'"

[tasks.lint]
description = "ESLintでコードをリント"
run = "bun eslint . --ext .js,.jsx,.cjs,.mjs,.ts,.tsx,.cts,.mjs,.vue"

[tasks.typecheck]
description = "TypeScriptの型チェックを実行"
run = ["mise typecheck:node", "mise typecheck:web"]

[tasks."typecheck:node"]
description = "メインプロセスの型チェックを実行"
run = "npx tsc --noEmit -p src/main/tsconfig.node.json --composite false"

[tasks."typecheck:web"]
description = "レンダラープロセスの型チェックを実行"
run = "npx vue-tsc --noEmit -p src/renderer/tsconfig.web.json --composite false"

[tasks.test]
description = "メインプロセスのテストを実行"
dir = "src/main"
run = "npx vitest tests/"

[tasks."test:renderer"]
description = "レンダラープロセスのテストを実行"
dir = "src/renderer"
run = "npx vitest src/renderer/tests/"

[tasks."test:all"]
description = "すべてのテストを実行"
run = ["mise run test", "mise run test:renderer"]

[tasks."test:ui"]
description = "メインプロセスのテストをUI付きで実行"
dir = "src/main"
run = "npm run test:ui"

[tasks."test:ui:renderer"]
description = "レンダラープロセスのテストをUI付きで実行"
dir = "src/renderer"
run = "npm run test:ui"

[tasks."test:coverage"]
description = "メインプロセスのテストをカバレッジ付きで実行"
dir = "src/main"
run = "npm run test:coverage"

[tasks."test:coverage:renderer"]
description = "レンダラープロセスのテストをカバレッジ付きで実行"
dir = "src/renderer"
run = "npm run test:coverage"

[tasks."test:swift"]
description = "Swiftヘルパーの単体テストを実行"
dir = "nativeSrc"
run = "swift test"

[tasks."afterSign"]
run = "node scripts/notarize.js"
